# OVN
Verified implementation of the Open Vote Network protocol

## Checking the proofs
To set up an opam switch with all the project dependencies do:
```
opam switch create ./ 4.14.1
eval $(opam env)
opam repo add rocq-released https://rocq-prover.org/opam/released
opam install --locked --deps-only ./coq-ovn.opam
opam install ./hax/coq-hacspec-ssprove.opam
```

The proofs can be checked with
```
make
```

## Hax embedding
Used for code extraction to Rocq (SSProve and ConCert)

To regenerate the embedded Hax code `Hacspec_ovn.v` (and `Hacspec_ovn_Ovn_traits.v`) file(s) do:
```
cd hax
./setup.sh
cd ../rust_src/ovn
cargo hax into ssprove
cd proofs/ssprove
./sed.sh
```
Then the new (fixed) files will be in `rust_src/ovn/proofs/ssprove/extraction/`.

## Documentation
Coqdoc can be generate with `make html`, the generated documentation will be in the `docs` directory.

## Project structure
|  |  |
|-----|-----|
| [theories/hacspec](/theories/hacspec/) | OVN formalization |
| TODO: describe each file in theories/hacspec folder | |
| [theories/ssprove](/theories/ssprove/) | SSP formalization of Schnorr |
| [rust_src/ovn](/rust_src/ovn/) | OVN implementation in Rust/Hax |
| [hax](/hax/) | A fork of the [Hax framework](https://github.com/cryspen/hax) containing modifications for smart contract integration |
| [docs](/docs/) | Directory containing coqdoc documentation after calling `make html` |

## Opam switch
The switch used to check the Rocq proofs.
Follow the instructions above to set it up.
```
# Name                      # Installed    # Synopsis
angstrom                    0.16.1         Parser combinators built for speed and memory-efficiency
atd                         2.16.0         Parser for the ATD data format description language
atdgen                      2.15.0         Generates efficient JSON serializers, deserializers and validators
atdgen-runtime              2.16.0         Runtime library for code generated by atdgen
atdts                       2.16.0         TypeScript code generation for ATD APIs
base                        v0.16.4        Full standard library replacement for OCaml
base-bigarray               base
base-threads                base
base-unix                   base
base_bigstring              v0.16.0        String type based on [Bigarray], for use in I/O and C-bindings
base_quickcheck             v0.16.0        Randomized testing framework, designed for compatibility with Base
batteries                   3.9.0          A community-maintained standard library extension
bigstringaf                 0.10.0         Bigstring intrinsics and fast blits based on memcpy/memmove
bin_prot                    v0.16.0        A binary protocol generator
biniou                      1.2.2          Binary data format designed for speed, safety, ease of use and backward compatibility as protocols evolve
camlp-streams               5.0.1          The Stream and Genlex libraries for use with Camlp4 and Camlp5
cmdliner                    1.3.0          Declarative definition of command line interfaces for OCaml
conf-gmp                    5              Virtual package relying on a GMP lib system installation
conf-pkg-config             4              Check if pkg-config is installed and create an opam switch local pkgconfig folder
coq                         8.20.1         pinned to version 8.20.1
coq-bignums                 9.0.0+coq8.20  Bignums, the Coq library of arbitrarily large numbers
coq-concert                 dev            pinned to version dev at git+https://github.com/AU-COBRA/ConCert.git#d06ca907c91cb46480d2e94e3666b84341c320fe
coq-core                    8.20.1         The Coq Proof Assistant -- Core Binaries and Tools
coq-deriving                0.2.2          Generic instances of MathComp classes
coq-elm-extraction          0.1.1          Coq extraction to Elm
coq-elpi                    2.5.2          Compatibility metapackage for Elpi extension language after the Rocq renaming
coq-equations               1.3.1+8.20     A function definition package for Coq
coq-ext-lib                 0.13.0         A library of Coq definitions, theorems, and tactics
coq-extructures             0.4.0          pinned to version 0.4.0
coq-hacspec-ssprove         dev            pinned to version dev at file:///OVN/hax
coq-hierarchy-builder       1.9.1          Compatibility package for rocq-hierarchy-builder
coq-mathcomp-algebra        2.2.0          Mathematical Components Library on Algebra
coq-mathcomp-analysis       1.2.0          An analysis library for mathematical components
coq-mathcomp-bigenough      1.0.2          A small library to do epsilon - N reasoning
coq-mathcomp-classical      1.2.0          pinned to version 1.2.0
coq-mathcomp-field          2.2.0          Mathematical Components Library on Fields
coq-mathcomp-fingroup       2.2.0          Mathematical Components Library on finite groups
coq-mathcomp-finmap         2.2.1          Compatibility package for rocq-mathcomp-finmap
coq-mathcomp-solvable       2.2.0          Mathematical Components Library on finite groups (II)
coq-mathcomp-ssreflect      2.2.0          pinned to version 2.2.0
coq-mathcomp-word           3.2            Yet Another Coq Library on Machine Words
coq-mathcomp-zify           1.5.0+2.0+8.16 Micromega tactics for Mathematical Components
coq-metacoq-common          1.3.4+8.20     The common library of Template Coq and PCUIC
coq-metacoq-erasure         1.3.4+8.20     Implementation and verification of an erasure procedure for Coq
coq-metacoq-pcuic           1.3.4+8.20     A type system equivalent to Coq's and its metatheory
coq-metacoq-safechecker     1.3.4+8.20     Implementation and verification of safe conversion and typechecking algorithms for Coq
coq-metacoq-template        1.3.4+8.20     A quoting and unquoting library for Coq in Coq
coq-metacoq-template-pcuic  1.3.4+8.20     Translations between Template Coq and PCUIC and proofs of correctness
coq-metacoq-utils           1.3.4+8.20     The utility library of Template Coq and PCUIC
coq-quickchick              2.1.0          Randomized Property-Based Testing for Coq
coq-rust-extraction         0.1.1          Coq extraction to Rust
coq-simple-io               1.11.0         IO monad for Coq
coq-ssprove                 0.2.4          A Foundational Framework for Modular Cryptographic Proofs
coq-stdlib                  8.20.1         The Coq Proof Assistant -- Standard Library
coq-stdpp                   1.11.0         An extended "Standard Library" for Coq
coqide-server               8.20.1         The Coq Proof Assistant, XML protocol server
core                        v0.16.2        Industrial strength alternative to OCaml's standard library
cppo                        1.8.0          Code preprocessor like cpp for OCaml
csexp                       1.5.2          Parsing and printing of S-expressions in Canonical form
dune                        3.19.1         Fast, portable, and opinionated build system
dune-configurator           3.19.1         Helper library for gathering system configuration
easy-format                 1.3.4          High-level and functional interface to the Format module of the OCaml standard library
elpi                        2.0.7          ELPI - Embeddable λProlog Interpreter
fieldslib                   v0.16.0        Syntax extension to define first class values representing record fields, to get and set record fields, iterate and fold over all fields of a record and create new record values
gen                         1.1            Iterators for OCaml, both restartable and consumable
hax-engine                  dev            pinned to version dev at file:///OVN/hax/engine
int_repr                    v0.16.0        Integers of various widths
jane-street-headers         v0.16.0        Jane Street C header files
js_of_ocaml                 6.0.1          Compiler from OCaml bytecode to JavaScript
js_of_ocaml-compiler        6.0.1          Compiler from OCaml bytecode to JavaScript
js_of_ocaml-ppx             6.0.1          Compiler from OCaml bytecode to JavaScript
jst-config                  v0.16.0        Compile-time configuration for Jane Street libraries
logs                        0.8.0          Logging infrastructure for OCaml
menhir                      20240715       An LR(1) parser generator
menhirCST                   20240715       Runtime support library for parsers generated by Menhir
menhirLib                   20240715       Runtime support library for parsers generated by Menhir
menhirSdk                   20240715       Compile-time library for auxiliary tools related to Menhir
non_empty_list              0.1            A non empty list library for OCaml
num                         1.5-1          The legacy Num library for arbitrary-precision integer and rational arithmetic
ocaml                       4.14.1         The OCaml compiler (virtual package)
ocaml-base-compiler         4.14.1         Official release 4.14.1
ocaml-compiler-libs         v0.12.4        OCaml compiler libraries repackaged
ocaml-config                2              OCaml Switch Configuration
ocaml-options-vanilla       1              Ensure that OCaml is compiled with no special options enabled
ocaml-syntax-shims          1.0.0          Backport new syntax to older OCaml versions
ocamlbuild                  0.16.1         OCamlbuild is a build system with builtin rules to easily build most OCaml projects
ocamlfind                   1.9.8          A library manager for OCaml
ocamlgraph                  2.2.0          A generic graph library for OCaml
octavius                    1.2.2          Ocamldoc comment syntax parser
parsexp                     v0.16.0        S-expression parsing library
pprint                      20230830       A pretty-printing combinator library and rendering engine
ppx_assert                  v0.16.0        Assert-like extension nodes that raise useful errors on failure
ppx_base                    v0.16.0        Base set of ppx rewriters
ppx_bench                   v0.16.0        Syntax extension for writing in-line benchmarks in ocaml code
ppx_bin_prot                v0.16.0        Generation of bin_prot readers and writers from types
ppx_cold                    v0.16.0        Expands [@cold] into [@inline never][@specialise never][@local never]
ppx_compare                 v0.16.0        Generation of comparison functions from types
ppx_custom_printf           v0.16.0        Printf-style format-strings for user-defined string conversion
ppx_derivers                1.2.1          Shared [@@deriving] plugin registry
ppx_deriving                6.0.3          Type-driven code generation for OCaml
ppx_deriving_yojson         3.9.1          JSON codec generator for OCaml
ppx_disable_unused_warnings v0.16.0        Expands [@disable_unused_warnings] into [@warning "-20-26-32-33-34-35-36-37-38-39-60-66-67"]
ppx_enumerate               v0.16.0        Generate a list containing all values of a finite type
ppx_expect                  v0.16.1        Cram like framework for OCaml
ppx_fields_conv             v0.16.0        Generation of accessor and iteration functions for ocaml records
ppx_fixed_literal           v0.16.0        Simpler notation for fixed point literals
ppx_globalize               v0.16.0        A ppx rewriter that generates functions to copy local values to the global heap
ppx_hash                    v0.16.0        A ppx rewriter that generates hash functions from type expressions and definitions
ppx_here                    v0.16.0        Expands [%here] into its location
ppx_ignore_instrumentation  v0.16.0        Ignore Jane Street specific instrumentation extensions
ppx_inline_test             v0.16.1        Syntax extension for writing in-line tests in ocaml code
ppx_jane                    v0.16.0        Standard Jane Street ppx rewriters
ppx_js_style                v0.16.0        Code style checker for Jane Street Packages
ppx_let                     v0.16.0        Monadic let-bindings
ppx_log                     v0.16.0        Ppx_sexp_message-like extension nodes for lazily rendering log messages
ppx_matches                 0.1            Small ppx to help check if a value matches a pattern
ppx_module_timer            v0.16.0        Ppx rewriter that records top-level module startup times
ppx_optcomp                 v0.16.0        Optional compilation for OCaml
ppx_optional                v0.16.0        Pattern matching on flat options
ppx_pipebang                v0.16.0        A ppx rewriter that inlines reverse application operators `|>` and `|!`
ppx_sexp_conv               v0.16.0        [@@deriving] plugin to generate S-expression conversion functions
ppx_sexp_message            v0.16.0        A ppx rewriter for easy construction of s-expressions
ppx_sexp_value              v0.16.0        A ppx rewriter that simplifies building s-expressions from ocaml values
ppx_stable                  v0.16.0        Stable types conversions generator
ppx_stable_witness          v0.16.0        Ppx extension for deriving a witness that a type is intended to be stable.  In this    context, stable means that the serialization format will never change.  This allows    programs running at different versions of the code to safely communicate.
ppx_string                  v0.16.0        Ppx extension for string interpolation
ppx_tydi                    v0.16.0        Let expressions, inferring pattern type from expression.
ppx_typerep_conv            v0.16.0        Generation of runtime types from type declarations
ppx_variants_conv           v0.16.0        Generation of accessor and iteration functions for ocaml variant types
ppx_yojson_conv             v0.16.0        [@@deriving] plugin to generate Yojson conversion functions
ppx_yojson_conv_lib         v0.16.0        Runtime lib for ppx_yojson_conv
ppxlib                      0.35.0         Standard infrastructure for ppx rewriters
re                          1.12.0         RE is a regular expression library for OCaml
rocq-elpi                   2.5.2          Elpi extension language for Coq
rocq-hierarchy-builder      1.9.1          High level commands to declare and evolve a hierarchy based on packed classes
rocq-mathcomp-finmap        2.2.1          Finite sets, finite maps, finitely supported functions
sedlex                      3.6            An OCaml lexer generator for Unicode
seq                         base           Compatibility package for OCaml's standard iterator type starting from 4.07.
sexplib                     v0.16.0        Library for serializing OCaml values to and from S-expressions
sexplib0                    v0.16.0        Library containing the definition of S-expressions and some base converters
splittable_random           v0.16.0        PRNG that can be split into independent streams
stdint                      0.7.2          Signed and unsigned integer types having specified widths
stdio                       v0.16.0        Standard IO library for OCaml
stdlib-shims                0.3.0          Backport some of the new stdlib features to older compiler
time_now                    v0.16.0        Reports the current time
topkg                       1.0.8          The transitory OCaml software packager
typerep                     v0.16.0        Typerep is a library for runtime types
variantslib                 v0.16.0        Part of Jane Street's Core library
yojson                      2.2.2          Yojson is an optimized parsing and printing library for the JSON format
zarith                      1.14           Implements arithmetic and logical operations over arbitrary-precision integers
```

## Extraction
```
opam switch create ovn 4.14.1
opam pin coq 8.20.1
opam pin coq-certicoq git+https://github.com/womeier/certicoq.git#33a62f58d92ea0a321b62349fb305486be7ace74
opam pin coq-concert git+https://github.com/AU-COBRA/ConCert.git#d06ca907c91cb46480d2e94e3666b84341c320fe
opam install coq-ssprove.0.2.4 coq-mathcomp-zify
opam install ./hax/coq-hacspec-ssprove.opam
```

wasmtime and python are required to run the WebAssembly benchmarks
